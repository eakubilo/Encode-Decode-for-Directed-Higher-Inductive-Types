\documentclass[main.tex]{subfiles}

\begin{document}
\noindent 
For our first example of a directed higher inductive type, we start with the \textif{directed interval}. 

 Let $I$ be the \textit{Segal} type generated by constructors

\begin{itemize}
    \item $0_I : I$
    \item $1_I : I$
    \item $\seg : \ho[I]{0_I}{1_I}$.
\end{itemize}

%yap about how we've departed from hott here and how composition isn't given for morphisms so if we want any form of "free generation", we must demand that I be segal.

\noindent The recursion principle for $I$ states that for any Segal type $B$ with

\begin{itemize}
    \item a point $b_0$
    \item a point $b_1$
    \item a morphism $s : \ho[B]{b_0}{b_1}$,
\end{itemize}
there is a function $f : I \to B$ such that $f(0_I)\equiv b_0$, $f(1_I) \equiv b_1$, and $f(\seg) = s$. 
%1. shouldn't this be a definitional equality?
%why should B be segal? maybe this goes back to the departure from regular hott 

The induction principle for $I$ states that for any inner type family $C : I \to U$ along with 
\begin{itemize}
    \item a point $c_0 : C(0_I)$
    \item a point $c_1 : C(1_I)$
    \item a dependent morphism $s : \ho[C(seg)]{c_0}{c_1}$,
\end{itemize} 
there is a function $ f : \prod_{(x : I)} C(x)$ such that $f(0_I) \equiv c_0$, $f(1_I) \equiv c_1$ and $f(\seg) = s$. %1.


%why should C be depdently segal? why do we want the total space to preserve the structure of I? yap about that
We can show that the recursion principle is derivable from the induction principle:
\begin{lemma}
 If $B$ is a Segal type with $b_0 : B$, $b_1 : B$ and $s : \ho[B]{b_0}{b_1}$, then there is a function $f : I \to B$ satisfying \begin{align*}
    &f(0_I) = b_0,\\ 
    &f(1_I) = b_1, \\  
    &f(\seg)=s
 \end{align*}
\end{lemma}

Moreover, we can also prove a uniqueness principle:
\begin{lemma}
 If $B$ is a Segal type and $f,g$ are two maps along with equalities
 \begin{align*}
    &p : f(0_I) =_B g(0_I),\\ 
    &q : f(1_I) =_B g(1_I),\\
    &r : f(\seg);q = p;g(\seg).
 \end{align*}
 Then for all $x : I$ we have $f(x) = g(x)$.
\end{lemma}


Not only does encode-decode allow us to characterize the path space of a given type, but the technique also allows us to characterize the morphisms of a given type. Since $\uc$ is Segal, we use the recursion principle for $I$ to define a type family $\co : I \to \uc$ with the defining equations:
\begin{align*}
    &\co (0_I) \defeq \vo\\
    &\co (1_I) \defeq \Un\\
    &\co (\seg) \coloneqq \dua\, !
\end{align*}
we note that the covariance of $\co$ allows us to prove basic facts about such a morphism in $I$.
\begin{lemma}
    $\ho[I]{1_I}{0_I} \simeq \vo$
\end{lemma}
\begin{proof}
    For any $f : \ho[I]{1_I}{0_I} $, we note that $\co_*(f)(\star) : \vo$, hence there is a term $\phi :\ho[I]{1_I}{0_I}$, which is enough to say that $\ho[I]{1_I}{0_I} \simeq \vo$
\end{proof}

We seek to show that $\co$ is represented by the representable $\ho[A]{1_I}{-}$. With that in mind, we want to exhibit a fiberwise equivalence between the representable and $\co$. So, we start by defining the fiberwise maps $\eco$ and $\dco$.

\begin{lemma}
    There is a function $$\eco: \prod_{(x:I)} \ho[I]{1_I}{x} \to \co(x)$$ 
\end{lemma}
\begin{proof}
    We can define $\eco$ by appealing to the Yoneda lemma:
    \begin{align*}
    \eco \defeq \text{yon}_{1_I}^{\co}(\star)
\end{align*}
\end{proof}


Since $\co$ and $\lambda x. \ho[I]{1_I}{x}$ are covariant and $I$ is Segal, we know that $\lambda x. \co(x) \to \ho[I]{1_I}{x}$ is inner. With that, and lemma 0.3, we can define $\dco$.
\begin{lemma}
    There is a function $$\dco : \prod_{(x:I)}\co(x) \to \ho[I]{1_I}{x}.$$
\end{lemma}
\begin{proof}
First, we define functions for the point constructors:
\begin{align*}
    &f \defeq \lambda\, u. \text{abort}(u)\\
    &g \defeq \lambda \_ . \id{1_I}
\end{align*}
If we want to define $\dco(0_I)$ as $f$ and $\dco(1_I)$ as $g$, to define $\dco(\seg)$, we need to produce a term of type $$\ho[(\lambda x . \co(x) \to {\ho[I]{1_I}{x}})(\seg)]{f}{g}$$ We can take advantage of directed univalence and ask instead for a term $$\ho[(\lambda x . {\ho[U_{\text{cov}}]{\co(x)}{\ho[I]{1_I}{x}}})(\seg)]{\dua f}{\dua g}.$$
Since $\co$ and $\ho[I]{1_I}{\_}$ are covariant, we have functions $\co_*(\seg)$ and $\seg_*$. 
\begin{align}
    &\dua(\seg_*)\cdot \dua(f) = \\
    &\dua(\seg_* \circ f) = \\
    &\dua(g \circ \co_*(\seg)) = \\
    &\dua(g) \cdot \dua(\co_*(\seg))
\end{align}
With the second equality coming from the fact that $\seg_* \circ f = g \circ \co_*(\seg)$ by functional extensionality. The equalities $(3)$ and $(5)$ are associated with $2$-simplexes witnessing the equality. We can take the pushout of the two $2-$simplices associated with the equalities, which diagrammatically gives a commutative square:
% https://q.uiver.app/#q=WzAsNCxbMywwLCJcXGhvbV9JKDFfSSwxX0kpIl0sWzAsMywiXFx0ZXh0e2NvZGV9KDBfSSkiXSxbMCwwLCJcXGhvbXtJfSgxX0ksMF9JKSJdLFszLDMsIlxcdGV4dHtjb2RlfSgxX0kpIl0sWzIsMCwiXFxkdWF7c2VnXyp9Il0sWzEsMiwiXFxkdWEgZiJdLFsxLDMsIlxcZHVhKFxcY29fKihcXHNlZykpIiwyXSxbMywwLCJcXGR1YSBnIiwyXV0=
\[s'= \begin{tikzcd}
	{\hom{I}(1_I,0_I)} &&& {\hom_I(1_I,1_I)} \\
	\\
	\\
	{\text{code}(0_I)} &&& {\text{code}(1_I)}
	\arrow["{\dua{(\seg_*)}}", from=1-1, to=1-4]
	\arrow["{\dua f}", from=4-1, to=1-1]
	\arrow["{\dua(\co_*(\seg))}"', from=4-1, to=4-4]
	\arrow["{\dua g}"', from=4-4, to=1-4]
\end{tikzcd}\]
From which, we can define a morphism:
$$\lambda i. \dcoe(s(i)) : \ho[\lambda x . \co(x) \to {\ho[I]{1_I}{x}}]{\dcoe{(\dua f)}}{\dcoe{(\dua{g}})}$$
which, since $\dua$ and $\dcoe$ are quasi-inverses, yields a morphism $$s : \ho[\lambda x . \co(x) \to {\ho[I]{1_I}{x}}]{f}{g},$$ as desired. Thus, we define $\dco$ as follows:
\begin{align*}
    &\dco(0_I) = f\\
    &\dco(1_I) = g\\
    &\dco(\seg) = s.
\end{align*}
\end{proof}

With $\eco$ and $\dco$ defined, we can show that they form an equivalence.

\begin{lemma}
    There is a map 
    $$ \eta : \Pi_{x : I} \Pi_{f : \ho[I]{1_I}{x}} \normalfont \dco \, x (\eco \, x f) = f$$
\end{lemma}
\begin{proof}
Noting that $\lambda x .\dco \, x (\eco \, x f) = f$ is covariant by theorem 8.26 in op. cit., we can further apply theorem 9.5 (dependent Yoneda lemma) in op. cit. So, it suffices to provide a term of the type
$$\dco \, 1_I (\eco \, 1_I \id{1_I}) = \id{1_I}.$$

Note, though, that $\eco$ was defined using the Yoneda lemma, hence it is a natural transformation that sends $\id{1_I}$ to $\star$. So, our equality becomes $$
\dco \, 1_I \, \star = \id{1_I}.$$ We know how $\dco$ acts on these inputs, so it suffices to provide a term of the type
$$\id{1_I} = \id{1_I}$$
of which $\refl{\id{1_I}}$ suffices.
\end{proof}
\begin{lemma}
    The type family $\normalfont \lambda (x,u) : \tilde{\co}\,. \eco \, x \, (\dco \, x \,u)=_{\co(x)} u$ is covariant.
\end{lemma}
\begin{proof}
    Let $(x,u),(y,v) : \tilde{\co}$ such that there is a morphism from $(x,u)$ to $(y,v)$. Since $\co$ is covvariant, it also suffices to consider a morphism $f : \ho[I]{x}{y}$ and $\text{trans}_{f,u} : \ho[\lambda x. \co(x)(f)]{u}{v}$.
    We can define a morphism $$f_t \defeq \lambda \,s . \, \bigwedge_f(t,s) : \ho[I]{x}{f(t)}.$$
    Thus, given a point $\mu : \eco \, x \, (\dco \, x \,u)=_{\co(x)} u$, the morphism $$\phi' \defeq \lambda t : \Delta^1. (f_t)_*(\mu)$$ has source $\mu$ and target $f_*(\mu): f_*(\eco \, x \, (\dco \, x \,u)) =_{\co(y)} f_*(u)$. 
    Since $\lambda x\, \lambda u \,. \eco \, x \, (\dco \, x \,u)$ is a fiberwise map between covariant types, $\phi'$ induces a map $\phi$ which has source $\mu$ which has type $$\eco \, x \, (\dco \, x \,u)) =_{\co(x)} u$$ and a target which has type $$\eco \, y \, (\dco \, y \,f_*(u))) =_{\co(y)} f_*(u).$$
    That is, $\phi$ is a map that lives over $f$ and trans$_{f,u}$.
    If there were another map $\psi$, then for every $t : \Delta^2$, $$\phi(t) : \eco \, f(t) \, (\dco \, f(t) \,(f_t)_*(u))) =_{\co(f(t))} (f_t)_*(u)$$
    and
    $$\psi(t) : \eco \, f(t) \, (\dco \, f(t) \,(f_t)_*(u))) =_{\co(f(t))} (f_t)_*(u)$$
    Note though, that 
    \begin{align*}
        &\eco \, f(t) \, (\dco \, f(t) \,(f_t)_*(u))) =_{\co(f(t))} (f_t)_*(u) \simeq \\
        &\ho[\lambda x.\co(x)(f_t)]{ \eco \, x \, (\dco \, x \,u)}{ (f_t)_*(u)}
    \end{align*}
    Since the latter type is contractible, we are done.
\end{proof}

\begin{lemma}
    There is a map 
    $$ \epsilon : \Pi_{x : I} \Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u$$
\end{lemma}
\begin{proof}
First, we note that the type family $\lambda x.\Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u $ is inner due to previous lemmas. Thus, we can define $\epsilon$ as follows:

$$\epsilon(0_I) = \lambda u. \text{abort}(u)$$
$$\epsilon(1_I) = \lambda \star. \refl{\star}$$
with $\epsilon(\seg)$ proceeding like $\dco (\seg)$.
\end{proof}

\end{document}
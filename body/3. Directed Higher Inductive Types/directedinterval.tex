\documentclass[main.tex]{subfiles}

\begin{document}
\noindent 
For our first example of a directed higher inductive type, we start with the \textit{directed interval}. 

 Let $I$ be the \textit{Segal} type generated by constructors

\begin{itemize}
    \item $0_I : I$
    \item $1_I : I$
    \item $\seg : \ho[I]{0_I}{1_I}$.
\end{itemize}

%yap about how we've departed from hott here and how composition isn't given for morphisms so if we want any form of "free generation", we must demand that I be segal.

\noindent The recursion principle for $I$ states that for any Segal type $B$ with

\begin{itemize}
    \item a point $b_0$
    \item a point $b_1$
    \item a morphism $s : \ho[B]{b_0}{b_1}$,
\end{itemize}
there is a function $f : I \to B$ such that $f(0_I)\equiv b_0$, $f(1_I) \equiv b_1$, and $f(\seg) = s$. 
%1. shouldn't this be a definitional equality?
%why should B be segal? maybe this goes back to the departure from regular hott 

The induction principle for $I$ states that for any inner type family $C : I \to U$ along with 
\begin{itemize}
    \item a point $c_0 : C(0_I)$
    \item a point $c_1 : C(1_I)$
    \item a dependent morphism $s : \ho[C(seg)]{c_0}{c_1}$,
\end{itemize} 
there is a function $ f : \prod_{(x : I)} C(x)$ such that $f(0_I) \equiv c_0$, $f(1_I) \equiv c_1$ and $f(\seg) = s$. %1.


%why should C be depdently segal? why do we want the total space to preserve the structure of I? yap about that
We can show that the recursion principle is derivable from the induction principle:
\begin{lemma}
 If $B$ is a Segal type with $b_0 : B$, $b_1 : B$ and $s : \ho[B]{b_0}{b_1}$, then there is a function $f : I \to B$ satisfying \begin{align*}
    &f(0_I) = b_0,\\ 
    &f(1_I) = b_1, \\  
    &f(\seg)=s
 \end{align*}
\end{lemma}

Moreover, we can also prove a uniqueness principle:
\begin{lemma}
 If $B$ is a Segal type and $f,g$ are two maps along with equalities
 \begin{align*}
    &p : f(0_I) =_B g(0_I),\\ 
    &q : f(1_I) =_B g(1_I),\\
    &r : f(\seg);q = p;g(\seg).
 \end{align*}
 Then for all $x : I$ we have $f(x) = g(x)$.
\end{lemma}


Not only does encode-decode allow us to characterize the path space of a given type, but the technique also allows us to characterize the morphisms of a given type. Since $\uc$ is Segal, we use the recursion principle for $I$ to define a type family $\co : I \to \uc$ with the defining equations:
\begin{align*}
    &\co (0_I) \defeq \vo\\
    &\co (1_I) \defeq \Un\\
    &\co (\seg) \coloneqq \dua\, !
\end{align*}
we note that the covariance of $\co$ allows us to prove basic facts about such a morphism in $I$.
\begin{lemma}
    $\ho[I]{1_I}{0_I} \simeq \vo$
\end{lemma}
\begin{proof}
    For any $f : \ho[I]{1_I}{0_I} $, we note that $\co_*(f)(\star) : \vo$, hence there is a term $\phi :\ho[I]{1_I}{0_I}$, which is enough to say that $\ho[I]{1_I}{0_I} \simeq \vo$
\end{proof}

We seek to show that $\co$ is represented by the representable $\ho[A]{1_I}{-}$. With that in mind, we want to exhibit a fiberwise equivalence between the representable and $\co$. So, we start by defining the fiberwise maps $\eco$ and $\dco$.

\begin{lemma}
    There is a function $$\eco: \prod_{(x:I)} \ho[I]{1_I}{x} \to \co(x)$$ 
\end{lemma}
\begin{proof}
    We can define $\eco$ by appealing to the Yoneda lemma:
    \begin{align*}
    \eco \defeq \text{yon}_{1_I}^{\co}(\star)
\end{align*}
\end{proof}


Since $\co$ and $\lambda x. \ho[I]{1_I}{x}$ are covariant and $I$ is Segal, we know that $\lambda x. \co(x) \to \ho[I]{1_I}{x}$ is inner. With that, and lemma 0.3, we can define $\dco$.
\begin{lemma}
    There is a function $$\dco : \prod_{(x:I)}\co(x) \to \ho[I]{1_I}{x}.$$
\end{lemma}
\begin{proof}
First, we define functions for the point constructors:
\begin{align*}
    &f \defeq \lambda\, u. \text{abort}(u)\\
    &g \defeq \lambda \_ . \idhom{1_I}
\end{align*}
which allows us to define the point constructors of $\dco$ as
\begin{align*}
    &\dco(0_I) = f\\
    &\dco(1_I) = g\\
\end{align*}

By lemma~\ref{lem:covhoissq}, to define $\dco(\seg)$, it suffices to show that $\seg_*\circ f = g \circ \seg_*$. 
It follows from the fact that both sides explode.
\end{proof}

With $\eco$ and $\dco$ defined, we can show that they form an equivalence.

\begin{lemma}
    There is a map 
    $$ \eta : \Pi_{x : I} \Pi_{f : \ho[I]{1_I}{x}} \normalfont \dco \, x (\eco \, x f) = f$$
\end{lemma}
\begin{proof}
Noting that $\lambda x .\dco \, x (\eco \, x f) = f$ is covariant by theorem 8.26 in op. cit., we can further apply theorem 9.5 (dependent Yoneda lemma) in op. cit. So, it suffices to provide a term of the type
$$\dco \, 1_I (\eco \, 1_I \idhom{1_I}) = \idhom{1_I}.$$

Note, though, that $\eco$ was defined using the Yoneda lemma, hence it is a natural transformation that sends $\idhom{1_I}$ to $\star$. So, our equality becomes $$
\dco \, 1_I \, \star = \idhom{1_I}.$$ We know how $\dco$ acts on these inputs, so it suffices to provide a term of the type
$$\idhom{1_I} = \idhom{1_I}$$
of which $\refl{\idhom{1_I}}$ suffices.
\end{proof}

\begin{lemma}
    There is a map 
    $$ \epsilon : \Pi_{x : I} \Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u$$
\end{lemma}
\begin{proof}
First, we note that the type family $\lambda x.\Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u $ is covariant by~\ref{cor:pathwithfunciscov}, so it is inner.
Proceeding with the proof, we partially define $\epsilon$ as follows:

$$\epsilon(0_I) = \lambda u. \text{abort}(u)$$
$$\epsilon(1_I) = \lambda \star. \refl{\star}$$
To complete the definition, we must define a term $$\epsilon(\seg) : \ho[(\lambda x.\Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u)\seg]{f}{g}.$$
By lemma~\ref{lem:depmorispath}, to inhabit the dependent morphism over $\seg$, we can provide a path in the type $$\seg_*(f) =_{\Pi_{u : \co(1_I)} \normalfont \eco \, 1_I (\dco \, 1_I u) = u} g$$
which is definitionally equal to the type $$\seg_*(f) =_{\Pi_{u : \Un} \normalfont \star = u}.$$
By lemma~\ref{lem:funext}, function extensionality, it suffices to define a term of type $$\prd{u : \Un}\seg_*(f)(u) =_{\star = u} g(u).$$
To define the map, assume $u : \Un$. By lemma~\ref{lem:ntypeidenntype}, the contractability of $\Un$ passes onto its identity types. So, $\star =_\Un u$ is also contractible. Thus, there is an inhabitant of the type
$$seg_*(f)(u) =_{\star = u} g(u).$$
We can name this function $\phi : \prd{u : \Un}\seg_*(f)(u) =_{\star = u} g(u)$ and trace it back the chain of equivalences to define a morphism
$$\phi' : \ho[(\lambda x.\Pi_{u : \co(x)} \normalfont \eco \, x (\dco \, x u) = u)\seg]{f}{g}.$$ We can then complete the definition of $\epsilon$ with
$$\epsilon(\seg) = \phi'$$.
\end{proof}

\end{document}